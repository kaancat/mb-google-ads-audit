{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Performance Analysis Schema",
  "description": "Schema for Phase 3 performance analysis output",
  "type": "object",
  "required": ["audit_period", "campaigns", "overall_metrics", "budget_analysis", "bid_strategy_analysis"],
  "properties": {
    "audit_period": {
      "type": "object",
      "required": ["start_date", "end_date", "days"],
      "properties": {
        "start_date": { "type": "string", "format": "date" },
        "end_date": { "type": "string", "format": "date" },
        "days": { "type": "integer", "minimum": 1 }
      }
    },
    "campaigns": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name", "type", "status"],
        "properties": {
          "name": { "type": "string" },
          "type": {
            "type": "string",
            "enum": ["Search", "Display", "Shopping", "Video", "Performance Max", "Discovery", "App"]
          },
          "status": {
            "type": "string",
            "enum": ["ENABLED", "PAUSED", "REMOVED"]
          },
          "metrics_30d": { "$ref": "#/definitions/metrics" },
          "metrics_90d": { "$ref": "#/definitions/metrics" },
          "metrics_180d": { "$ref": "#/definitions/metrics" },
          "limited_by_budget": { "type": "boolean" },
          "is_lost_budget_pct": {
            "type": "number",
            "minimum": 0,
            "maximum": 100,
            "description": "Impression share lost due to budget (%)"
          },
          "is_lost_rank_pct": {
            "type": "number",
            "minimum": 0,
            "maximum": 100,
            "description": "Impression share lost due to rank (%)"
          },
          "bid_strategy": { "type": "string" },
          "bid_strategy_target": { "type": "number" },
          "bid_strategy_actual": { "type": "number" }
        }
      }
    },
    "overall_metrics": { "$ref": "#/definitions/metrics" },
    "budget_analysis": {
      "type": "object",
      "required": ["total_daily_budget", "campaigns_limited_by_budget"],
      "properties": {
        "total_daily_budget": {
          "type": "number",
          "minimum": 0,
          "description": "Total daily budget across all campaigns (DKK)"
        },
        "campaigns_limited_by_budget": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Names of campaigns limited by budget"
        },
        "budget_opportunity_dkk": {
          "type": "number",
          "description": "Estimated additional monthly spend if budgets increased"
        },
        "budget_efficiency_score": {
          "type": "string",
          "enum": ["excellent", "good", "needs_attention", "poor"],
          "description": "Overall budget utilization assessment"
        }
      }
    },
    "bid_strategy_analysis": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["campaign", "strategy", "assessment"],
        "properties": {
          "campaign": { "type": "string" },
          "strategy": {
            "type": "string",
            "enum": ["Manual CPC", "Enhanced CPC", "Maximize Clicks", "Maximize Conversions", "Target CPA", "Target ROAS", "Maximize Conversion Value", "Target Impression Share"]
          },
          "target": {
            "type": "number",
            "description": "Bid strategy target (CPA in DKK or ROAS %)"
          },
          "actual": {
            "type": "number",
            "description": "Actual achieved value (CPA in DKK or ROAS %)"
          },
          "assessment": {
            "type": "string",
            "enum": ["on_target", "above_target", "below_target", "insufficient_data", "wrong_strategy"]
          },
          "recommendation": { "type": "string" }
        }
      }
    },
    "findings": {
      "type": "array",
      "items": { "$ref": "#/definitions/finding" },
      "description": "Performance-related findings from this phase"
    }
  },
  "definitions": {
    "metrics": {
      "type": "object",
      "properties": {
        "cost": {
          "type": "number",
          "minimum": 0,
          "description": "Total cost (DKK)"
        },
        "conversions": {
          "type": "number",
          "minimum": 0
        },
        "cpa": {
          "type": "number",
          "minimum": 0,
          "description": "Cost per acquisition (DKK)"
        },
        "roas": {
          "type": "number",
          "minimum": 0,
          "description": "Return on ad spend (%)"
        },
        "clicks": { "type": "integer", "minimum": 0 },
        "impressions": { "type": "integer", "minimum": 0 },
        "ctr": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Click-through rate (%)"
        },
        "conversion_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Conversion rate (%)"
        },
        "impression_share": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Search impression share (%)"
        },
        "avg_cpc": {
          "type": "number",
          "minimum": 0,
          "description": "Average cost per click (DKK)"
        }
      }
    },
    "finding": {
      "type": "object",
      "required": ["id", "title", "severity", "category"],
      "properties": {
        "id": { "type": "string", "pattern": "^F[0-9]{3}$" },
        "title": { "type": "string" },
        "severity": { "type": "string", "enum": ["CRITICAL", "HIGH", "MEDIUM", "LOW"] },
        "category": {
          "type": "string",
          "enum": ["PERFORMANCE_BUDGET", "PERFORMANCE_BID_STRATEGY", "PERFORMANCE_COMPETITION"]
        },
        "description": { "type": "string" },
        "impact_dkk": { "type": "number" },
        "evidence": { "type": "string" },
        "recommendation": { "type": "string" }
      }
    }
  }
}
